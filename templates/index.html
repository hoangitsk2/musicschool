{% extends "layout.html" %}
{% block title %}Dashboard • auto_break_player{% endblock %}
{% block content %}
<section class="grid gap-6 lg:grid-cols-3">
  <div class="stats shadow bg-base-100 col-span-1">
    <div class="stat">
      <div class="stat-title">Status</div>
      <div class="stat-value" id="status-text">{{ state.status|capitalize }}</div>
      <div class="stat-desc">Heartbeat {{ state.heartbeat_at or '—' }}</div>
    </div>
  </div>
  <div class="stats shadow bg-base-100 col-span-1">
    <div class="stat">
      <div class="stat-title">Volume</div>
      <div class="stat-value" id="volume-value">{{ state.volume }}</div>
      <div class="stat-desc">Default {{ config.volume_default }}</div>
    </div>
  </div>
  <div class="stats shadow bg-base-100 col-span-1">
    <div class="stat">
      <div class="stat-title">Power</div>
      <div class="stat-value" id="power-value">{{ 'ON' if state.power_on else 'OFF' }}</div>
      <div class="stat-desc">Relay status</div>
    </div>
  </div>
</section>

<section class="mt-8 grid gap-6 lg:grid-cols-3">
  <div class="card bg-base-100 shadow col-span-2">
    <div class="card-body space-y-4">
      <h2 class="card-title">Session Control</h2>
      <form id="play-form" class="grid gap-4 md:grid-cols-2">
        <label class="form-control w-full">
          <div class="label"><span class="label-text">Playlist</span></div>
          <select name="playlist_id" class="select select-bordered" required>
            <option value="" disabled selected>Select playlist</option>
            {% for playlist in playlists %}
              <option value="{{ playlist.id }}" {% if playlist.id == state.playlist_id %}selected{% endif %}>{{ playlist.name }}</option>
            {% endfor %}
          </select>
        </label>
        <label class="form-control w-full">
          <div class="label"><span class="label-text">Session length (minutes)</span></div>
          <input type="number" name="minutes" min="1" class="input input-bordered" value="{{ config.session_default_minutes }}" />
        </label>
        <div class="md:col-span-2 flex flex-wrap gap-2">
          <button class="btn btn-primary" type="submit">Play</button>
          <button class="btn btn-error" data-action="stop" type="button">Stop</button>
          <button class="btn btn-secondary" data-action="skip" type="button">Skip</button>
        </div>
      </form>
      <div>
        <label class="form-control">
          <div class="label"><span class="label-text">Volume</span></div>
          <input
            id="volume-slider"
            type="range"
            min="0"
            max="100"
            value="{{ state.volume }}"
            class="range range-primary"
          />
        </label>
      </div>
      <div class="flex gap-2">
        <button class="btn" data-power="on">Power ON</button>
        <button class="btn" data-power="off">Power OFF</button>
      </div>
    </div>
  </div>
  <div class="card bg-base-100 shadow">
    <div class="card-body space-y-4">
      <h2 class="card-title">Now Playing</h2>
      <div>
        <p class="text-sm opacity-70">Playlist</p>
        <p class="text-lg font-semibold">{{ current_playlist.name if current_playlist else '—' }}</p>
      </div>
      <div>
        <p class="text-sm opacity-70">Track</p>
        <p class="text-lg font-semibold">{{ current_track.orig_filename if current_track else '—' }}</p>
      </div>
      <div>
        <p class="text-sm opacity-70">Session ends</p>
        <p class="text-lg" id="session-end">{{ state.session_end_at or '—' }}</p>
      </div>
    </div>
  </div>
</section>

<section class="mt-8">
  <h2 class="text-xl font-semibold mb-4">Schedules</h2>
  <div class="overflow-x-auto">
    <table class="table table-zebra">
      <thead>
        <tr>
          <th>Name</th>
          <th>Playlist</th>
          <th>Days</th>
          <th>Start</th>
          <th>Minutes</th>
          <th>Enabled</th>
        </tr>
      </thead>
      <tbody>
        {% for schedule in schedules %}
          <tr>
            <td>{{ schedule.name }}</td>
            <td>{{ schedule.playlist.name if schedule.playlist else '—' }}</td>
            <td>{{ schedule.days }}</td>
            <td>{{ schedule.start_time }}</td>
            <td>{{ schedule.session_minutes }}</td>
            <td>
              <form method="post" action="{{ url_for('toggle_schedule', schedule_id=schedule.id) }}">
                <button class="btn btn-xs {{ 'btn-success' if schedule.enabled else 'btn-outline' }}" type="submit">
                  {{ 'Enabled' if schedule.enabled else 'Disabled' }}
                </button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="6" class="text-center opacity-70">No schedules defined.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
